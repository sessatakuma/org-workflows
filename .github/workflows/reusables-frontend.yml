---
name: 'Frontend Code Quality Checks'

on:  # yamllint disable-line rule:truthy
  workflow_call:
    inputs:
      node-version:
        description: 'The Node.js version to use'
        required: false
        type: string
        default: '20'
    secrets:
      CHECKER_TOKEN:
        description: 'The GITHUB_TOKEN passed from the caller'
        required: true
    outputs:
      prettier-status:
        description: "The status of the Prettier formatting check."
        value: ${{ jobs.frontend-checks.outputs.prettier-status }}
      prettier-summary:
        description: "A summary of the Prettier formatting check."
        value: ${{ jobs.frontend-checks.outputs.prettier-summary }}
      eslint-status:
        description: "The status of the ESLint check."
        value: ${{ jobs.frontend-checks.outputs.eslint-status }}
      eslint-summary:
        description: "A summary of the ESLint check."
        value: ${{ jobs.frontend-checks.outputs.eslint-summary }}

permissions:
  contents: read
  pull-requests: write
  checks: write

env:
  DEFAULT_PRETTIER_CONFIG: |
    {
      "semi": true,
      "singleQuote": true,
      "trailingComma": "es5",
      "tabWidth": 2,
      "useTabs": false,
      "arrowParens": "always",
      "printWidth": 80
    }
  DEFAULT_ESLINT_CONFIG: |
    import js from "@eslint/js";
    import globals from "globals";

    export default [
        js.configs.recommended,
        {
            files: ["**/*.{js,mjs,cjs,jsx}"],

            languageOptions: {
                ecmaVersion: "latest",
                sourceType: "module",
                globals: {
                    ...globals.browser,
                    ...globals.node,
                    ...globals.es2021
                },
                parserOptions: {
                    ecmaFeatures: {
                        jsx: true
                    }
                }
            },
            rules: {
                "no-console": "warn",
                "no-unused-vars": "warn",
                "no-var": "error"
            },
        },
        {
            ignores: [
                "dist/**",
                "node_modules/**",
                "build/**"
            ]
        }
    ];


jobs:
  frontend-checks:
    name: 'Frontend Code Quality Checks'
    runs-on: ubuntu-latest
    # yamllint disable rule:line-length
    outputs:
      prettier-status: ${{ steps.frontend-checks.outputs.prettier-status }}
      prettier-summary: ${{ steps.frontend-checks.outputs.prettier-summary }}
      eslint-status: ${{ steps.frontend-checks.outputs.eslint-status }}
      eslint-summary: ${{ steps.frontend-checks.outputs.eslint-summary }}
    # yamllint enable
    steps:
      - name: Run Frontend Checks
        id: frontend-checks
        uses: ./.github/actions/frontend-checks
        with:
          node-version: ${{ inputs.node-version }}
